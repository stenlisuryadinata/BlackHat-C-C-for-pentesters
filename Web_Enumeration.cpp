#include <iostream>
#include <vector>
#include <string>
#include <cpr/cpr.h>

// Correction: Initialize 'files' vector with filenames
std::vector<std::string> files = {"password.txt", "secrets.txt"};

// Correction: Initialize 'baseUrl' with the base URL
std::string baseUrl = "http://127.0.0.1:8000/";

// Correction: Initialize 'maxDepth' with the desired value
int maxDepth = 3;

// Correction: Initialize directories vector with subdirectories
std::vector<std::string> directories = {"secrets/", "backups/"};

void processDirectory(std::string directory, int currentDepth) {
    // Process files in this directory
    for (const auto& file : files) {
        std::string url = baseUrl + directory + file;
        cpr::Response r = cpr::Get(cpr::Url{url});
        if (r.status_code == 200) {
            std::cout << "Found file: " << url << std::endl;
        } else {
            std::cout << "File not found: " << url << std::endl;
        }
    }

    // Don't go further if max depth is reached
    if (currentDepth >= maxDepth) {
        return;
    };

    // Process subdirectories
    for (const auto& subdirectory : directories) {
        processDirectory(directory + subdirectory, currentDepth + 1);
    }
}

int main() {
    // Iterate over directories and start the directory processing
    for (const auto& directory : directories) {
        processDirectory(directory, 1);
    }
    return 0;
}

//compilation to run 

/*
export LD_LIBRARY_PATH=/home/ubuntu/work/cpr/lib:$LD_LIBRARY_PATH
g++-11 -fdiagnostics-color=always -g /home/ubuntu/work/Web_Enumeration.cpp -o /home/ubuntu/work/Web_Enumeration -lcpr -lcurl
./Web_Enumeration

*/


// to find the files at the specified URLs
// 1. Create the directory structure and files 
/*
mkdir secrets
echo "password" > secrets/password.txt
*/
//2. Start  a python web server
/*
python3 -m http.server
*/
//3. run the compilation command
/*
export LD_LIBRARY_PATH=/home/ubuntu/work/cpr/lib:$LD_LIBRARY_PATH 
g++-11 -fdiagnostics-color=always -g /home/ubuntu/work/Web_Enumeration.cpp -o /home/ubuntu/work/Web_Enumeration -lcpr -lcurl
./Web_Enumeration

*/